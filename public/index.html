<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>RUNA COFFEE - El Alma del Eje Cafetero</title>
    
    <meta name="description" content="Descubre el café de especialidad de Manizales, Colombia. Granos seleccionados que cuentan la historia de nuestra tierra.">
    <meta property="og:title" content="RUNA COFFEE - Origen Manizales">
    <meta property="og:description" content="Descubre el café de especialidad de Manizales, Colombia. Granos seleccionados que cuentan la historia de nuestra tierra.">
    <meta property="og:image" content="https://i.ibb.co/L5TjL4q/IMG-20250620-WA0020.jpg">
    <meta property="og:url" content="https://runacoffee.vercel.app">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="RUNA COFFEE - Origen Manizales">
    <meta name="twitter:description" content="Descubre el café de especialidad de Manizales, Colombia.">
    <meta name="twitter:image" content="https://i.ibb.co/L5TjL4q/IMG-20250620-WA0020.jpg">
    <link rel="icon" href="https://i.ibb.co/L5TjL4q/IMG-20250620-WA0020.jpg" type="image/jpeg">
    <meta name="theme-color" content="#3a2e2a">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Roboto+Slab:wght@700&display=swap" rel="stylesheet">
    
    <!-- Google's <model-viewer> component for 3D and AR -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"></script>

    <!-- Custom Styles and Theme -->
    <style>
        :root {
            --runa-bg: #FDFBF8; 
            --runa-bg-alt: #F4F1ED; 
            --runa-text: #3a2e2a;
            --runa-text-alt: #786A65; 
            --runa-heading: #2c221f; 
            --runa-primary: #D47500;
            --runa-secondary: #0072CE;
            --runa-border: #E2E8F0; 
            --runa-shadow: rgba(0,0,0,0.05);
            --runa-header-bg: #2c221f;
        }
        html.dark {
            --runa-bg: #1A1A1A; 
            --runa-bg-alt: #2c221f; 
            --runa-text: #E2E8F0;
            --runa-text-alt: #A0AEC0; 
            --runa-heading: #FFFFFF; 
            --runa-primary: #D47500;
            --runa-secondary: #38B2AC;
        }
        body { font-family: 'Poppins', sans-serif; background-color: var(--runa-bg); color: var(--runa-text); transition: background-color 0.3s ease, color 0.3s ease; }
        h1, h2, h3 { font-family: 'Roboto Slab', serif; color: var(--runa-heading); transition: color 0.3s ease; }
        .section-bg { background-color: var(--runa-bg-alt); transition: background-color 0.3s ease; }
        html { scroll-behavior: smooth; }
        
        #main-header { 
            background-color: var(--runa-bg); 
            box-shadow: 0 1px 3px var(--runa-shadow);
            border-bottom: 1px solid var(--runa-border);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        #mobile-menu { 
            background-color: var(--runa-bg); 
            transition: background-color 0.3s ease;
        }
        #cart-icon-wrapper { 
            position: relative;
        }
        #cart-counter {
            position: absolute;
            top: 0;
            right: 0;
            transform: translate(25%, -25%);
            width: 1.25rem;
            height: 1.25rem;
            background-color: #DC2626;
            color: white;
            font-size: 0.75rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.25rem;
        }

        /* Styles for Video Intro and Page Load */
        #video-intro {
            position: fixed;
            inset: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
            transition: opacity 0.75s ease-out;
        }
        #video-intro.hidden {
            opacity: 0;
            pointer-events: none;
        }

        #page-content { 
            opacity: 0; 
            transition: opacity 0.75s ease-in;
            transition-delay: 0.2s;
            visibility: hidden; /* Start as hidden */
        }
        #page-content.loaded { 
            opacity: 1; 
            visibility: visible; /* Become visible when loaded */
        }
        
        .modal-enter { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }

        model-viewer {
            width: 100%;
            height: 450px;
            border-radius: 0.75rem;
            background-color: transparent;
        }
    </style>
</head>

<body class="antialiased">

    <!-- Video Intro Section -->
    <div id="video-intro">
        <video id="intro-video" class="fixed inset-0 w-full h-full object-cover bg-black" autoplay muted playsinline>
            <source src="https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/ff90488b09cf62571f02c5d7893563cb48734f27/public/assets%20/VIDEOS/runa-intro.mp4" type="video/mp4">
            Tu navegador no soporta el elemento de video.
        </video>
    </div>

    <!-- Main Page Content (initially hidden) -->
    <div id="page-content">
        
        <header id="main-header" class="sticky top-0 left-0 right-0 z-40">
            <nav class="container mx-auto px-4 sm:px-6 py-2 flex justify-between items-center h-20">

                <!-- Left Container: Menu & User -->
                <div class="flex-1 flex justify-start items-center space-x-2 sm:space-x-4">
                    <button class="text-[var(--runa-text)] p-2" id="menu-button" aria-label="Abrir menú">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
                    </button>
                    <div id="auth-container" class="flex items-center">
                        <!-- User/Login button is rendered here by JavaScript -->
                    </div>
                </div>

                <!-- Center Container: Logo -->
                <div class="flex-shrink-0">
                    <a href="#" class="h-16 w-16 flex items-center justify-center rounded-full overflow-hidden bg-white shadow-md">
                        <video autoplay loop muted playsinline class="h-full w-full object-cover">
                            <source src="https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/ff90488b09cf62571f02c5d7893563cb48734f27/public/assets%20/VIDEOS/runa-logo-animado.mp4" type="video/mp4">
                            Tu navegador no soporta la etiqueta de video.
                        </video>
                    </a>
                </div>


                <!-- Right Container: Theme & Cart -->
                <div class="flex-1 flex justify-end items-center space-x-2 sm:space-x-4">
                    <!-- === THEME TOGGLE BUTTON (MOVED FROM MENU) === -->
                    <button id="theme-toggle" class="p-2 rounded-full text-[var(--runa-text)] hover:bg-[var(--runa-bg-alt)]" aria-label="Cambiar tema de color">
                        <svg id="theme-icon-sun" class="h-6 w-6 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.707.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm-1.414 8.486l.707-.707a1 1 0 011.414 1.414l-.707.707a1 1 0 01-1.414-1.414zM4 11a1 1 0 100-2H3a1 1 0 100 2h1z"/></svg>
                        <svg id="theme-icon-moon" class="h-6 w-6 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                    </button>
                    <div id="cart-icon-wrapper">
                        <button id="open-cart-button" class="relative p-1 text-[var(--runa-text)]">
                           <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                           <span id="cart-counter" class="hidden">0</span>
                        </button>
                    </div>
                </div>
            </nav>
            
            <div id="mobile-menu" class="hidden absolute w-full shadow-lg border-t border-[var(--runa-border)]">
                <div class="container mx-auto px-6 py-4 space-y-3">
                     <a href="#filosofia" class="mobile-nav-link block text-sm text-[var(--runa-text)] hover:text-[var(--runa-primary)] transition-colors">Nuestra Filosofía</a>
                     <a href="#experiencia-3d" class="mobile-nav-link block text-sm text-[var(--runa-text)] hover:text-[var(--runa-primary)] transition-colors">Experiencia 3D</a>
                     <a href="#tienda" class="mobile-nav-link block text-sm text-[var(--runa-text)] hover:text-[var(--runa-primary)] transition-colors">Tienda</a>
                     <a href="#contacto" class="mobile-nav-link block text-sm text-[var(--runa-text)] hover:text-[var(--runa-primary)] transition-colors">Contacto</a>
                     <div class="border-t border-[var(--runa-border)] pt-4 flex items-center justify-between">
                         <span class="text-sm font-semibold text-[var(--runa-text-alt)]">Opciones:</span>
                         <div class="flex items-center space-x-2">
                             <!-- === SOUND TOGGLE BUTTON REMAINS HERE === -->
                             <button id="sound-toggle" class="p-2 rounded-full text-[var(--runa-text)] hover:bg-[var(--runa-bg-alt)]" aria-label="Activar/Desactivar sonido">
                                 <svg id="sound-icon-on" class="h-6 w-6 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M5.071 8.042a.75.75 0 01.95.405A5.002 5.002 0 0010 13a5 5 0 003.979-4.553.75.75 0 011.352.49A6.5 6.5 0 0110 14.5a6.5 6.5 0 01-5.18-10.27.75.75 0 01.251-1.188z"></path><path d="M10 11a3.5 3.5 0 100-7 3.5 3.5 0 000 7zm0-1.5a2 2 0 100-4 2 2 0 000 4z"></path></svg>
                                 <svg id="sound-icon-off" class="h-6 w-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9.965 2.023a.75.75 0 01.07 1.057l-6.86 8.328a.75.75 0 01-1.168-.942l6.86-8.328a.75.75 0 011.098-.115z" clip-rule="evenodd"></path><path d="M8.5 6.385a3.502 3.502 0 013.313-1.362.75.75 0 11.458-1.442 5.002 5.002 0 00-4.733 1.95l-1.34 1.638A.75.75 0 015.03 6.01L6.23 4.81a.75.75 0 111.06 1.06L6.105 7.057c.05-.054.1-.107.151-.16a3.5 3.5 0 012.244-.512z"></path><path d="M13.979 12.553a.75.75 0 011.06 1.06l-1.339 1.34a5.001 5.001 0 01-4.734-1.95l-1.34-1.638a.75.75 0 111.168-.942l1.34 1.638a3.501 3.501 0 004.845.492z"></path></svg>
                             </button>
                         </div>
                     </div>
                </div>
            </div>
        </header>
        
        <main>
            <section id="hero" class="relative h-screen flex items-center justify-center text-white" style="background-image: url('https://images.unsplash.com/photo-1511920183353-3c9c9b062c19?q=80&w=2070&auto=format&fit=crop'); background-size: cover; background-position: center;">
                <div class="absolute inset-0 bg-black/60 z-10"></div>
                <div class="relative z-20 text-center px-4">
                    <h1 class="text-4xl md:text-6xl font-bold tracking-tight mb-4">RUNA COFFEE</h1>
                    <p class="max-w-2xl mx-auto text-lg md:text-xl opacity-90">El alma del Eje Cafetero en tu taza.</p>
                </div>
            </section>

            <section id="filosofia" class="py-20 section-bg">
                <div class="container mx-auto px-6 text-center">
                    <h2 class="text-3xl md:text-4xl font-bold mb-4">El Corazón de Manizales</h2>
                    <p class="max-w-3xl mx-auto text-[var(--runa-text-alt)]">
                        [CONTENIDO PENDIENTE DE APROBACIÓN POR LA DUEÑA] <br>
                        Aquí se contará la historia de RUNA COFFEE, su conexión con los caficultores del Eje Cafetero, el respeto por la tierra y el compromiso con la calidad que nace en las montañas de Manizales.
                    </p>
                </div>
            </section>
            
            <section id="experiencia-3d" class="py-20">
                <div class="container mx-auto px-6 text-center">
                    <h2 class="text-3xl md:text-4xl font-bold mb-4">Vive la Experiencia 3D</h2>
                    <p class="max-w-3xl mx-auto text-[var(--runa-text-alt)] mb-12">
                        Interactúa con nuestro árbol místico. Si estás en un celular, presiona el botón de RA para traer la magia de Runa a tu propio espacio.
                    </p>
                    
                    <model-viewer id="ar-viewer"
                        src="https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/776b9c0c5a976bff5e8077da365a60a5e5c3e616/public/assets%20/3D/arbol_final.glb"
                        ios-src="https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/776b9c0c5a976bff5e8077da365a60a5e5c3e616/public/assets%20/3D/arbol_final.glb"
                        ar
                        ar-modes="webxr scene-viewer quick-look"
                        ar-scale="auto"
                        camera-controls
                        auto-rotate
                        alt="Un modelo 3D de un árbol estilizado"
                        preload
                        reveal="auto">
                        
                        <button slot="ar-button" class="absolute bottom-4 right-4 bg-white rounded-full px-4 py-2 font-semibold shadow-lg text-gray-800 transition-transform transform hover:scale-105">
                            Ver en tu espacio
                        </button>
                    </model-viewer>
                    
                    <div id="ar-failure-message" class="hidden mt-4 text-center text-red-500 bg-red-100 dark:bg-red-900 dark:text-red-300 p-3 rounded-lg">
                        Lo sentimos, tu dispositivo no es compatible con la Realidad Aumentada.
                    </div>
                </div>
            </section>

            <section id="tienda" class="py-20 section-bg">
                <div class="container mx-auto px-6">
                    <h2 class="text-3xl md:text-4xl font-bold text-center mb-12">Nuestra Selección de Café</h2>
                    <div class="flex flex-col md:flex-row gap-10">
                        <aside class="w-full md:w-1/4 lg:w-1/5">
                            <h3 class="text-xl font-bold mb-4 border-b border-[var(--runa-border)] pb-2">Filtrar por</h3>
                            <div class="space-y-6">
                                <div>
                                    <h4 class="font-semibold mb-2">Categoría</h4>
                                    <label class="flex items-center cursor-pointer"><input type="radio" name="category" class="mr-2 accent-[var(--runa-primary)]">En Grano</label>
                                    <label class="flex items-center cursor-pointer"><input type="radio" name="category" class="mr-2 accent-[var(--runa-primary)]">Molido</label>
                                </div>
                                <div>
                                    <h4 class="font-semibold mb-2">Región</h4>
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" class="mr-2 accent-[var(--runa-primary)]">Manizales, Caldas</label>
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" class="mr-2 accent-[var(--runa-primary)]">Neira, Caldas</label>
                                </div>
                                <div>
                                    <h4 class="font-semibold mb-2">Variedad</h4>
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" class="mr-2 accent-[var(--runa-primary)]">Castillo</label>
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" class="mr-2 accent-[var(--runa-primary)]">Caturra</label>
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" class="mr-2 accent-[var(--runa-primary)]">Geisha</label>
                                </div>
                                <div>
                                    <h4 class="font-semibold mb-2">Proceso</h4>
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" class="mr-2 accent-[var(--runa-primary)]">Lavado</label>
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" class="mr-2 accent-[var(--runa-primary)]">Natural</label>
                                </div>
                                <div>
                                    <h4 class="font-semibold mb-2">Tueste</h4>
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" class="mr-2 accent-[var(--runa-primary)]">Claro</label>
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" class="mr-2 accent-[var(--runa-primary)]">Medio</label>
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" class="mr-2 accent-[var(--runa-primary)]">Oscuro</label>
                                </div>
                            </div>
                        </aside>

                        <div id="product-grid" class="w-full md:w-3/4 lg:w-4/5 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                            <!-- Products will be inserted here by JavaScript -->
                        </div>
                    </div>
                </div>
            </section>
        </main>
        
        <footer id="contacto" class="bg-gray-800 dark:bg-black text-gray-300 pt-16 pb-8">
            <div class="container mx-auto px-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-10 text-center md:text-left">
                    <div>
                        <h3 class="text-2xl font-bold text-white mb-4">Contáctanos</h3>
                        <p class="text-gray-400">Manizales, Caldas, Colombia</p>
                        <p class="mt-2"><strong>Email:</strong> <a href="mailto:runacoffee25@gmail.com" class="text-teal-400 hover:underline">runacoffee25@gmail.com</a></p>
                        <p><strong>WhatsApp:</strong> <a href="https://wa.me/573001627532" target="_blank" class="text-teal-400 hover:underline">+57 300 162 7532</a></p>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold text-white mb-4">Síguenos</h3>
                        <div class="flex justify-center md:justify-start space-x-4">
                            <a href="#" target="_blank" class="transition-transform hover:scale-110"><img src="https://placehold.co/24x24/FFFFFF/000000?text=F" alt="Logo de Facebook" class="h-6 w-auto rounded"></a>
                            <a href="#" target="_blank" class="transition-transform hover:scale-110"><img src="https://placehold.co/24x24/FFFFFF/000000?text=I" alt="Logo de Instagram" class="h-6 w-auto rounded"></a>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold text-white mb-4">Formas de Pago</h3>
                        <div id="payment-logos" class="flex justify-center md:justify-start flex-wrap items-center gap-4 mb-2"></div>
                        <p class="text-xs text-gray-400">Pagos seguros a través de nuestra plataforma.</p>
                    </div>
                </div>
                <div class="border-t border-gray-700 py-6 mt-8 text-center text-xs text-gray-400">
                    <p>&copy; <span id="year"></span> RUNA COFFEE. Todos los derechos reservados.</p>
                    <div class="mt-4 space-x-4">
                        <a href="#" class="text-teal-400 hover:underline">Políticas de Privacidad</a>
                        <span class="text-gray-500">|</span>
                        <a href="#" class="text-teal-400 hover:underline">Términos de Servicio</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    
    <a href="https://wa.me/573001627532?text=Hola,%20estoy%20interesado%20en%20el%20café%20de%20RUNA%20COFFEE." class="fixed bottom-6 right-6 z-50 bg-green-500 rounded-full w-16 h-16 shadow-lg hover:bg-green-600 transition-transform hover:scale-110 flex items-center justify-center overflow-hidden" target="_blank">
        <svg class="w-9 h-9 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99 0-3.916-.539-5.574-1.54L.057 24zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.886-.001 2.267.655 4.398 1.908 6.166l-1.138 4.167 4.274-1.12z"/></svg>
    </a>

    <audio id="background-audio" loop>
        <source src="https://cdn.pixabay.com/audio/2022/10/24/audio_5b13856b46.mp3" type="audio/mpeg">
        Tu navegador no soporta el elemento de audio.
    </audio>
    
    <div id="cart-modal" class="fixed inset-0 z-50 flex items-end sm:items-center sm:justify-end p-4 bg-black/70 backdrop-blur-sm hidden"></div>
    <div id="auth-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm hidden">
       <div class="w-full max-w-xs bg-[var(--runa-header-bg)] rounded-2xl shadow-2xl p-8 flex flex-col modal-enter relative text-center">
            <button id="close-auth-modal-button" class="absolute top-3 right-3 text-gray-500 hover:text-white transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <h2 class="text-2xl font-bold text-white mb-2">Bienvenido a Runa</h2>
            <p class="text-gray-400 mb-6">Inicia sesión o crea una cuenta</p>
            <button id="google-login-button-modal" class="w-full inline-flex items-center justify-center gap-3 px-4 py-2 text-base font-semibold text-gray-700 bg-white border border-transparent rounded-lg shadow-sm hover:bg-gray-200 transition-all">
                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.574l6.19,5.238C41.38,34.783,44,29.865,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path></svg>
                <span>Iniciar sesión con Google</span>
            </button>
       </div>
    </div>
    
    <script type="module">
        // Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, collection, getDocs, writeBatch, onSnapshot, addDoc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // IMPORTANT: Replace with your Firebase config
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Product data
        const coffeeProducts = [
            { id: 'Runa01', name: 'Runa Origen Manizales', region: 'Manizales, Caldas', variety: 'Castillo', process: 'Lavado', roast: 'Medio', notes: 'Notas a panela, naranja y chocolate.', image: 'https://placehold.co/400x400/3a2e2a/FFFFFF?text=Runa+01' },
            { id: 'Runa02', name: 'Finca El Mirador', region: 'Manizales, Caldas', variety: 'Caturra', process: 'Lavado', roast: 'Medio', notes: 'Cuerpo balanceado, acidez cítrica y dulzor residual.', image: 'https://placehold.co/400x400/3a2e2a/FFFFFF?text=Runa+02' },
            { id: 'Runa03', name: 'Microlote Natural', region: 'Neira, Caldas', variety: 'Castillo', process: 'Natural', roast: 'Claro', notes: 'Sabor intenso a frutos rojos, vino y canela.', image: 'https://placehold.co/400x400/3a2e2a/FFFFFF?text=Runa+03' },
            { id: 'Runa04', name: 'Tesoro Geisha', region: 'Manizales, Caldas', variety: 'Geisha', process: 'Lavado', roast: 'Claro', notes: 'Perfil complejo y elegante, con notas a jazmín y bergamota.', image: 'https://placehold.co/400x400/3a2e2a/FFFFFF?text=Runa+04' }
        ];

        const productGrid = document.getElementById('product-grid');
        
        function renderProducts(products) {
            if (!productGrid) return;
            productGrid.innerHTML = '';
            products.forEach(prod => {
                const card = document.createElement('div');
                card.className = "block bg-[var(--runa-bg)] rounded-lg overflow-hidden border border-[var(--runa-border)] shadow-lg hover:shadow-xl transition-all duration-300 flex flex-col group hover:-translate-y-2";
                card.innerHTML = `
                    <div class="overflow-hidden h-48 bg-gray-300 dark:bg-gray-700 flex items-center justify-center text-gray-500">
                        <img src="${prod.image}" alt="${prod.name}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x400/cccccc/ffffff?text=Imagen+no+disponible';">
                    </div>
                    <div class="p-6 flex flex-col flex-grow">
                        <div class="flex-grow">
                            <h3 class="text-xl font-bold mb-2">${prod.name}</h3>
                            <p class="text-sm text-[var(--runa-text-alt)] mb-1"><strong>Origen:</strong> ${prod.region}</p>
                            <p class="text-sm text-[var(--runa-text-alt)]">${prod.notes}</p>
                        </div>
                        <button data-item-id="${prod.id}" data-item-name="${prod.name}" class="add-to-cart-btn mt-6 w-full text-center bg-[var(--runa-primary)] text-white text-sm font-semibold py-2 px-4 rounded-full group-hover:bg-[var(--runa-secondary)] transition-colors">Añadir al Carrito</button>
                    </div>
                `;
                productGrid.appendChild(card);
            });
        }
        
        // App state and DOM elements
        let currentUser = null;
        let cartUnsubscribe = null;
        const authContainer = document.getElementById('auth-container');
        const authModal = document.getElementById('auth-modal');
        const closeAuthModalButton = document.getElementById('close-auth-modal-button');
        const googleLoginButtonModal = document.getElementById('google-login-button-modal');
        const cartModalContainer = document.getElementById('cart-modal');
        const openCartButton = document.getElementById('open-cart-button');
        
        // Auth state change handler
        onAuthStateChanged(auth, async (user) => {
            currentUser = user;
            if (user) {
                renderUserUI(user);
                await mergeLocalCartWithFirestore();
                setupCartListener();
            } else {
                renderGuestUI();
                if (cartUnsubscribe) {
                    cartUnsubscribe();
                    cartUnsubscribe = null;
                }
                updateCartFromLocal();
            }
        });

        // Auth functions
        const loginWithGoogle = () => {
            const provider = new GoogleAuthProvider();
            provider.setCustomParameters({ prompt: 'select_account' });
            signInWithPopup(auth, provider)
                .then(() => authModal.classList.add('hidden'))
                .catch((error) => console.error("Google Sign-In Error:", error));
        };
        const logout = () => signOut(auth).catch((error) => console.error("Sign-Out Error:", error));
        
        // Local cart functions
        const getLocalCart = () => JSON.parse(localStorage.getItem("runa_cart_local")) || [];
        const saveLocalCart = (cart) => localStorage.setItem("runa_cart_local", JSON.stringify(cart));
        const clearLocalCart = () => localStorage.removeItem("runa_cart_local");

        // Cart logic
        async function mergeLocalCartWithFirestore() {
            const localCart = getLocalCart();
            if (localCart.length === 0 || !currentUser) return;
            const cartRef = collection(db, "carts", currentUser.uid, "items");
            const firestoreCartSnapshot = await getDocs(cartRef);
            const firestoreItems = new Map(firestoreCartSnapshot.docs.map(d => [d.data().name, {id: d.id, ...d.data()}]));
            const batch = writeBatch(db);
            localCart.forEach(localItem => {
                const firestoreItem = firestoreItems.get(localItem.name);
                if (firestoreItem) {
                    const itemDocRef = doc(db, "carts", currentUser.uid, "items", firestoreItem.id);
                    batch.update(itemDocRef, { quantity: firestoreItem.quantity + localItem.quantity });
                } else {
                    const newItemDocRef = doc(collection(db, "carts", currentUser.uid, "items"));
                    batch.set(newItemDocRef, localItem);
                }
            });
            await batch.commit();
            clearLocalCart();
        }

        function setupCartListener() {
            if (!currentUser) return;
            const cartRef = collection(db, "carts", currentUser.uid, "items");
            cartUnsubscribe = onSnapshot(cartRef, (snapshot) => {
                const cart = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateCartUI(cart);
                if (!cartModalContainer.classList.contains('hidden')) {
                    renderCartModal(cart);
                }
            });
        }
        
        function updateCartFromLocal() {
            const cart = getLocalCart();
            updateCartUI(cart);
        }

        window.addToCart = async (item) => {
            if (currentUser) {
                const cartRef = collection(db, "carts", currentUser.uid, "items");
                const q = await getDocs(collection(db, "carts", currentUser.uid, "items"));
                const existingItemDoc = q.docs.find(d => d.data().name === item.name);
                if (existingItemDoc) {
                    await updateDoc(existingItemDoc.ref, { quantity: existingItemDoc.data().quantity + 1 });
                } else {
                    await addDoc(cartRef, { ...item, quantity: 1 });
                }
            } else {
                let cart = getLocalCart();
                const existingItem = cart.find(i => i.name === item.name);
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    cart.push({ ...item, quantity: 1 });
                }
                saveLocalCart(cart);
                updateCartFromLocal();
            }
        };

        window.updateItemQuantity = async (itemId, newQuantity) => {
            if (newQuantity < 1) {
                await window.removeItemFromCart(itemId);
                return;
            }
            if (currentUser) {
                const itemRef = doc(db, "carts", currentUser.uid, "items", itemId);
                await updateDoc(itemRef, { quantity: newQuantity });
            } else {
                let cart = getLocalCart();
                const itemToUpdate = cart.find(i => i.id === itemId);
                if (itemToUpdate) itemToUpdate.quantity = newQuantity;
                saveLocalCart(cart);
                updateCartFromLocal();
                renderCartModal(getLocalCart());
            }
        };

        window.removeItemFromCart = async (itemId) => {
            if (currentUser) {
                await deleteDoc(doc(db, "carts", currentUser.uid, "items", itemId));
            } else {
                let cart = getLocalCart().filter(i => i.id !== itemId);
                saveLocalCart(cart);
                updateCartFromLocal();
                renderCartModal(cart);
            }
        };

        // UI Rendering functions
        const renderUserUI = (user) => {
            const userImage = user.photoURL ? `<img src="${user.photoURL}" alt="${user.displayName}" class="w-full h-full object-cover">` : `<span class="text-[var(--runa-text)] dark:text-white font-bold text-xl">${user.displayName ? user.displayName.charAt(0).toUpperCase() : 'U'}</span>`;
            authContainer.innerHTML = `<div class="relative"><button id="user-menu-button" title="Mi Cuenta" class="w-9 h-9 rounded-full flex items-center justify-center transition-transform hover:scale-110 shadow-sm overflow-hidden border-2 border-gray-300 dark:border-gray-600 hover:border-[var(--runa-primary)] bg-gray-200 dark:bg-gray-700">${userImage}</button><div id="user-menu-dropdown" class="hidden absolute top-full left-0 mt-2 w-56 bg-[var(--runa-bg)] border border-[var(--runa-border)] rounded-lg shadow-xl z-50"><div class="px-4 py-3 border-b border-[var(--runa-border)]"><p class="text-sm font-semibold text-[var(--runa-heading)] truncate">${user.displayName || 'Usuario'}</p><p class="text-xs text-[var(--runa-text-alt)] truncate">${user.email || 'Sin email'}</p></div><div class="py-1"><a href="#" id="logout-button-menu" class="flex items-center w-full text-left px-4 py-2 text-sm text-[var(--runa-text)] hover:bg-[var(--runa-bg-alt)] hover:text-[var(--runa-primary)] transition-colors">Cerrar Sesión</a></div></div></div>`;
            document.getElementById('logout-button-menu').addEventListener('click', (e) => { e.preventDefault(); logout(); });
            const userMenuButton = document.getElementById('user-menu-button');
            const userMenuDropdown = document.getElementById('user-menu-dropdown');
            userMenuButton.addEventListener('click', (e) => { e.stopPropagation(); userMenuDropdown.classList.toggle('hidden'); });
            window.addEventListener('click', () => { if (userMenuDropdown) userMenuDropdown.classList.add('hidden'); });
        };

        const renderGuestUI = () => {
            authContainer.innerHTML = `<button id="open-auth-modal-button" title="Acceder o Registrarse" class="w-9 h-9 rounded-full flex items-center justify-center transition-colors shadow-sm overflow-hidden text-[var(--runa-text)]"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg></button>`;
            document.getElementById('open-auth-modal-button').addEventListener('click', () => authModal.classList.remove('hidden'));
        };

        const updateCartUI = (cart) => {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const cartCounter = document.getElementById('cart-counter');
            if (cartCounter) {
                cartCounter.textContent = totalItems;
                cartCounter.classList.toggle('hidden', totalItems === 0);
            }
        };

        function renderCartModal(cart) {
            const actionButtonHtml = cart.length > 0 ? `<a href="#" class="w-full inline-flex items-center justify-center gap-3 px-5 py-3 text-base font-semibold text-white bg-green-500 rounded-lg shadow-sm hover:bg-green-600 transition-all"><span>Proceder al Pago</span></a>` : '<a href="#tienda" class="w-full block text-center bg-[var(--runa-primary)] text-white font-bold py-3 px-5 rounded-lg" onclick="closeCartModal()">Volver a la tienda</a>';
            const cartItemsHtml = cart.length === 0 ? `<p class="text-gray-400 py-8 text-center">Tu carrito está vacío.</p>` : cart.map(item => `<div class="flex justify-between items-center py-3"><span class="text-gray-300 pr-2 flex-grow">${item.name}</span><div class="flex items-center gap-2 text-white"><button onclick="updateItemQuantity('${item.id}', ${item.quantity - 1})" class="w-7 h-7 rounded-full bg-gray-600 hover:bg-gray-500 transition-colors">-</button><span class="w-8 text-center">${item.quantity}</span><button onclick="updateItemQuantity('${item.id}', ${item.quantity + 1})" class="w-7 h-7 rounded-full bg-gray-600 hover:bg-gray-500 transition-colors">+</button><button onclick="removeItemFromCart('${item.id}')" class="ml-2 text-red-400 hover:text-red-300 transition-colors" aria-label="Eliminar item"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button></div></div>`).join("");
            cartModalContainer.innerHTML=`<div class="w-full max-w-md bg-[var(--runa-header-bg)] rounded-2xl shadow-2xl p-6 flex flex-col modal-enter"><div class="text-center mb-6"><h2 class="text-2xl font-bold text-white">Tu Carrito de Café</h2></div><div class="border-t border-gray-700 pt-4 flex-grow overflow-y-auto" style="max-height: 40vh;"><div id="cart-items" class="divide-y divide-gray-700 text-left">${cartItemsHtml}</div></div><div class="mt-auto pt-4 space-y-3">${actionButtonHtml}<button class="mt-2 text-sm text-gray-400 hover:text-white w-full" onclick="closeCartModal()">Cerrar</button></div></div>`;
        }
        window.closeCartModal = () => cartModalContainer.classList.add('hidden');
        
        // --- Main DOMContentLoaded event listener ---
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- Robust Video Intro Logic ---
            const videoIntro = document.getElementById('video-intro');
            const introVideo = document.getElementById('intro-video');
            const pageContent = document.getElementById('page-content');
            let introFinished = false;

            const endIntro = () => {
                if (introFinished) return; // Prevent running multiple times
                introFinished = true;

                videoIntro.classList.add('hidden');
                
                // Use a short delay to ensure the video div is hidden before fading in content
                setTimeout(() => {
                    pageContent.classList.add('loaded');
                }, 100);
            };

            // 1. Event listener for when the video ends
            introVideo.addEventListener('ended', endIntro);
            
            // 2. Event listener for errors
            introVideo.addEventListener('error', endIntro);

            // 3. Safety net timer: if nothing happens after 5.5s, force the content to show
            const safetyTimer = setTimeout(endIntro, 5500);

            // Try to play the video, catching potential errors for silent failure
            introVideo.play().catch(error => {
                console.warn("Video autoplay was prevented. Showing content immediately.", error);
                endIntro(); // If play fails, just end the intro.
            });

            // --- END: Video Intro Logic ---


            renderProducts(coffeeProducts);

            authContainer.innerHTML = `<div class="w-9 h-9 rounded-full bg-gray-200 dark:bg-gray-700 animate-pulse"></div>`;
            googleLoginButtonModal.addEventListener('click', loginWithGoogle);
            closeAuthModalButton.addEventListener('click', () => authModal.classList.add('hidden'));
            authModal.addEventListener('click', (event) => { if (event.target === authModal) authModal.classList.add('hidden'); });

            const menuButton = document.getElementById('menu-button'); const mobileMenu = document.getElementById('mobile-menu'); const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
            menuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
            mobileNavLinks.forEach(link => link.addEventListener('click', () => mobileMenu.classList.add('hidden')));
            
            // Theme Controls
            const themeToggle = document.getElementById('theme-toggle'); 
            const sunIcon = document.getElementById('theme-icon-sun'); 
            const moonIcon = document.getElementById('theme-icon-moon'); 
            const applyTheme = (theme) => { 
                document.documentElement.classList.toggle('dark', theme === 'dark'); 
                sunIcon.classList.toggle('hidden', theme !== 'dark'); 
                moonIcon.classList.toggle('hidden', theme === 'dark'); 
            }; 
            themeToggle.addEventListener('click', () => { 
                const newTheme = document.documentElement.classList.contains('dark') ? 'light' : 'dark'; 
                localStorage.setItem('theme', newTheme); 
                applyTheme(newTheme); 
            });
            const savedTheme = localStorage.getItem('theme') || 'light'; 
            applyTheme(savedTheme);

            // Audio Controls
            const audio = document.getElementById('background-audio');
            const soundToggle = document.getElementById('sound-toggle');
            const soundIconOn = document.getElementById('sound-icon-on');
            const soundIconOff = document.getElementById('sound-icon-off');

            const toggleSound = () => {
                if (audio.paused) {
                    audio.play().catch(e => console.error("Error playing audio:", e));
                    soundIconOff.classList.add('hidden');
                    soundIconOn.classList.remove('hidden');
                } else {
                    audio.pause();
                    soundIconOn.classList.add('hidden');
                    soundIconOff.classList.remove('hidden');
                }
            };
            soundToggle.addEventListener('click', toggleSound);
            soundIconOff.classList.remove('hidden'); // Initial state
            
            // Footer setup
            const paymentLogosContainer = document.getElementById('payment-logos');
            if(paymentLogosContainer) {
                const paymentMethods = [ 'Mastercard', 'Visa', 'Amex', 'PayPal' ];
                paymentLogosContainer.innerHTML = ''; 
                paymentMethods.forEach(m => { paymentLogosContainer.innerHTML += `<img src="https://placehold.co/48x32/FFFFFF/000000?text=${m}" alt="${m}" title="${m}" class="h-8 bg-white rounded-md p-1">`; });
            }
            document.getElementById('year').textContent = new Date().getFullYear();
            
            // Cart events
            openCartButton.addEventListener('click', async () => {
                const cart = currentUser ? (await getDocs(collection(db, "carts", currentUser.uid, "items"))).docs.map(d => ({id: d.id, ...d.data()})) : getLocalCart();
                renderCartModal(cart);
                cartModalContainer.classList.remove('hidden');
            });
            
            document.body.addEventListener('click', (e) => {
                if (e.target.closest('.add-to-cart-btn')) {
                    const button = e.target.closest('.add-to-cart-btn');
                    const item = { id: button.dataset.itemId, name: button.dataset.itemName };
                    window.addToCart(item);
                }
            });

            // AR Compatibility Check
            const arViewer = document.getElementById('ar-viewer');
            if(arViewer) {
                arViewer.addEventListener('ar-status', (event) => {
                    if(event.detail.status === 'failed'){
                        document.getElementById("ar-failure-message").classList.remove('hidden');
                    }
                });
            }
        });

    </script>

</body>

</html>
