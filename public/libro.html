<!doctype html>
<html lang="es" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuaderno Digital Interactivo - RUNA Coffee</title>
    
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <style type="text/css">
        :root {
            --runa-primary: #D47500;
            --runa-secondary: #0072CE;
            --slider-track-color: #25D366;
        }
        html { scroll-behavior: smooth; }
        
        body { 
            font-family: 'Poppins', sans-serif; 
            transition: background-color 0.4s ease, color 0.4s ease; 
            margin: 0;
            overflow: hidden;
        }

        #video-background { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            z-index: -2; 
            transition: opacity 0.5s ease-in-out; 
        }
        
        .translucent-panel { 
            backdrop-filter: blur(16px); 
            -webkit-backdrop-filter: blur(16px); 
        }

        /* --- Theme Styles --- */
        html:not(.dark) body { background-color: #e0e0e0; color: #3a2e2a; }
        html:not(.dark) .translucent-panel { background-color: rgba(255, 255, 255, 0.5); border-color: rgba(0,0,0,0.1); }
        html:not(.dark) .flipbook .page { background-color: #fdfbf7; color: #333; }
        html:not(.dark) .page .content-wrapper h2, html:not(.dark) .page .content-wrapper h3 { color: #1c1c1c; }
        html:not(.dark) .page .content-wrapper p, html:not(.dark) .page .content-wrapper li { color: #4a4a4a; }
        html:not(.dark) .signature { color: #585858; }
        html:not(.dark) .page-number { color: rgba(0, 0, 0, 0.4); }
        html:not(.dark) .page.hard .page-number { color: rgba(255, 255, 255, 0.7); }
        html:not(.dark) .mixer-icon-button { background-color: #F4F1ED; border-color: #E2E8F0; }
        html:not(.dark) .mixer-icon-button.active { border-color: var(--runa-primary); }
        html:not(.dark) input[type="range"] { --track-background: #E2E8F0; }
        html:not(.dark) .video-list-button.active { background-color: rgba(0,0,0,0.1); }

        html.dark body { background-color: #111; color: #E2E8F0; }
        html.dark .translucent-panel { background-color: rgba(0, 0, 0, 0.3); border-color: rgba(255, 255, 255, 0.1); }
        html.dark .flipbook .page { background-color: #2a2a2a; color: #e0e0e0; }
        html.dark .page .content-wrapper h2, html.dark .page .content-wrapper h3 { color: #f0f0f0; }
        html.dark .page .content-wrapper p, html.dark .page .content-wrapper li { color: #cccccc; }
        html.dark .signature { color: #a0a0a0; }
        html.dark .page-number { color: rgba(255, 255, 255, 0.4); }
        html.dark .page.hard .page-number { color: rgba(255, 255, 255, 0.7); }
        html.dark .mixer-icon-button { background-color: #2D3748; border-color: #4A5568; }
        html.dark .mixer-icon-button.active { border-color: var(--runa-primary); }
        html.dark input[type="range"] { --track-background: #4A5568; }
        html.dark .video-list-button.active { background-color: rgba(255,255,255,0.15); }

        .flipbook-viewport { display: flex; justify-content: center; align-items: center; height: 100vh; width: 100vw; position: fixed; top: 0; left: 0; }
        .flipbook-container { width: 90vw; height: 85vh; max-width: 500px; max-height: 700px; position: relative; }
        .flipbook { width: 100%; height: 100%; }
        .flipbook .page { box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: background-color 0.3s ease, color 0.3s ease; }
        .flipbook .hard { background-color: #101010; box-shadow: inset 0 0 5px #000; }
        .cover-page { 
            background-color: #101010 !important;
            background-image: url(https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/fda92b2028bf402986396801d14ae0bc4bb58359/public/assets/imagenes/portada-libro.jpg);
            background-size: contain !important;
            background-repeat: no-repeat !important;
            background-position: center !important;
        }

        .page .content-wrapper { padding: 30px; height: 100%; overflow-y: auto; }
        .page .content-wrapper h2.handwriting-title { font-family: 'Dancing Script', cursive; font-size: 2.5rem; margin-bottom: 1rem; }
        .page .content-wrapper h3 { font-weight: 700; margin-top: 1.5rem; margin-bottom: 0.5rem; }
        .page .content-wrapper p, .page .content-wrapper li { font-size: 0.95rem; line-height: 1.6; }
        .page .content-wrapper ul { list-style-position: inside; padding-left: 10px; }
        .signature { font-family: 'Dancing Script', cursive; font-size: 1.8rem; text-align: right; margin-top: 2rem; }
        
        .page-number { position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%); font-size: 0.9em; }
        .drawing-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: crosshair; touch-action: none; }
        
        .menu-section-header { padding: 1rem 1.5rem; font-weight: 700; cursor: pointer; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; }
        .menu-section-header i { transition: transform 0.3s ease; }
        .menu-section-header.active i { transform: rotate(180deg); }
        .menu-section-content { display: none; padding: 1.5rem; background-color: rgba(0,0,0,0.2); }
        
        .tool-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(50px, 1fr)); gap: 15px; }
        .tool-button { width: 55px; height: 55px; background-color: rgba(255, 255, 255, 0.1); border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 12px; cursor: pointer; transition: background-color 0.2s; border: 1px solid transparent; color: white; }
        .tool-button i { font-size: 20px; margin-bottom: 5px; }
        .tool-button:hover { background-color: rgba(138, 43, 226, 0.5); }
        .tool-button.active { background-color: #8a2be2; border-color: rgba(255,255,255,0.5); }
        
        .color-palette { display: flex; gap: 10px; margin-top: 15px; }
        .color-swatch { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; transition: border-color 0.2s; }
        .color-swatch.active { border-color: white; }
        
        input[type="range"].line-width-slider { -webkit-appearance: none; appearance: none; width: 100%; height: 8px; background: #555; border-radius: 5px; outline: none; opacity: 0.7; transition: opacity .2s; }
        input[type="range"].line-width-slider:hover { opacity: 1; }
        input[type="range"].line-width-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; background: #8a2be2; cursor: pointer; border-radius: 50%; }
        
        .mixer-icon-button { border: 2px solid; transition: border-color 0.3s ease; display: flex; align-items: center; justify-content: center; }
        .mixer-icon-button img { width: 100%; height: 100%; object-fit: cover; }
        input[type="range"].volume-slider { -webkit-appearance: none; appearance: none; width: 100%; height: 8px; border-radius: 5px; outline: none; background: transparent; }
        input[type="range"].volume-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; background: var(--runa-primary); cursor: pointer; border-radius: 50%; border: 2px solid; margin-top: -6px; }
        input[type="range"].volume-slider::-moz-range-thumb { width: 20px; height: 20px; background: var(--runa-primary); cursor: pointer; border-radius: 50%; border: 2px solid; }
        html:not(.dark) input[type="range"].volume-slider::-webkit-slider-thumb { border-color: #FDFBF8; }
        html:not(.dark) input[type="range"].volume-slider::-moz-range-thumb { border-color: #FDFBF8; }
        html.dark input[type="range"].volume-slider::-webkit-slider-thumb { border-color: #111; }
        html.dark input[type="range"].volume-slider::-moz-range-thumb { border-color: #111; }
        input[type="range"].volume-slider::-webkit-slider-runnable-track { width: 100%; height: 8px; cursor: pointer; border-radius: 5px; background: linear-gradient(to right, var(--slider-track-color) var(--value-percent, 0%), var(--track-background) var(--value-percent, 0%)); }
        input[type="range"].volume-slider::-moz-range-track { width: 100%; height: 8px; cursor: pointer; border-radius: 5px; background: linear-gradient(to right, var(--slider-track-color) var(--value-percent, 0%), var(--track-background) var(--value-percent, 0%)); }
    
        #cart-counter { position: absolute; top: 0; right: 0; transform: translate(25%, -25%); width: 1.25rem; height: 1.25rem; background-color: #DC2626; color: white; font-size: 0.75rem; font-weight: bold; display: flex; align-items: center; justify-content: center; border-radius: 0.25rem; }
        
        .calculator { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 280px; background: #222; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); padding: 20px; z-index: 1001; display: none; }
        .calc-header { cursor: move; padding-bottom: 10px; color: white; display:flex; justify-content:space-between; align-items:center; }
        .calc-header .close-btn { cursor: pointer; font-size: 1.2rem; }
        .calc-display { width: 100%; background: #333; color: white; border: none; border-radius: 8px; padding: 15px; text-align: right; font-size: 2.5rem; margin-bottom: 15px; }
        .calc-keys { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .calc-btn { background: #555; color: white; border: none; border-radius: 8px; padding: 20px; font-size: 1.2rem; cursor: pointer; transition: background-color 0.2s; }
        .calc-btn.operator { background: #f9a825; }
    </style>
</head>
<body>

<div id="video-background-wrapper">
    <video id="video-background" autoplay loop muted playsinline>
        <source id="video-source" src="https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/71882ac786adf1438958f62935ab5b2d35a82ae5/public/assets/videos/cascada-relajante.mp4" type="video/mp4">
    </video>
</div>

<header id="main-header" class="fixed top-0 left-0 right-0 z-40">
    <nav class="container mx-auto px-4 sm:px-6 py-2 flex justify-between items-center h-20">
        <div class="flex-1 flex justify-start items-center space-x-2 sm:space-x-4">
            <button class="text-white p-2" id="menu-button" aria-label="Open menu">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
            </button>
            <button id="theme-toggle" class="p-2 rounded-full text-white" aria-label="Change color theme">
                <svg id="theme-icon-sun" class="h-6 w-6 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.707.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm-1.414 8.486l.707-.707a1 1 0 011.414 1.414l-.707.707a1 1 0 01-1.414-1.414zM4 11a1 1 0 100-2H3a1 1 0 100 2h1z"/></svg>
                <svg id="theme-icon-moon" class="h-6 w-6 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
            </button>
        </div>
        <div class="flex-shrink-0">
             <a href="index.html" class="h-16 w-16 flex items-center justify-center rounded-full overflow-hidden bg-white shadow-md">
                <video autoplay loop muted playsinline class="w-full h-full object-contain">
                    <source src="https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/ff90488b09cf62571f02c5d7893563cb48734f27/public/assets%20/VIDEOS/runa-logo-animado.mp4" type="video/mp4">
                </video>
            </a>
        </div>
        <div class="flex-1 flex justify-end items-center space-x-2 sm:space-x-4">
            <button id="video-skin-toggle" class="p-2 rounded-full text-white" aria-label="Open video selector">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
            </button>
            <button id="mixer-toggle-button" class="w-9 h-9 rounded-full overflow-hidden focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--runa-primary)]" aria-label="Open ambiance mixer">
                <video autoplay loop muted playsinline class="w-full h-full object-cover">
                    <source src="https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/5ec8a9f9a44f0f1d347867a8b1293a1f8f5dae5e/public/assets/videos/runa-equalizer-video.mp4" type="video/mp4">
                </video>
            </button>
            <div id="cart-icon-wrapper" class="relative">
                <button id="open-cart-button" class="p-1 text-white">
                   <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                   <span id="cart-counter" class="hidden">0</span>
                </button>
            </div>
        </div>
    </nav>
    <div id="main-menu" class="hidden absolute w-full shadow-lg border-t translucent-panel">
        <div class="container mx-auto px-6 py-4 text-white">
             <div class="menu-section">
                <div class="menu-section-header">
                    <span>Herramientas Creativas</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="menu-section-content">
                    <div class="tool-grid">
                        <div class="tool-button" id="tool-pencil" title="Lápiz"><i class="fas fa-pencil-alt"></i><span>Lápiz</span></div>
                        <div class="tool-button" id="tool-eraser" title="Borrador"><i class="fas fa-eraser"></i><span>Borrador</span></div>
                        <div class="tool-button" id="tool-upload" title="Subir Imagen"><i class="fas fa-image"></i><span>Foto</span></div>
                        <div class="tool-button" id="tool-clear" title="Limpiar Página"><i class="fas fa-trash"></i><span>Limpiar</span></div>
                    </div>
                    <div class="color-palette">
                        <div class="color-swatch active" style="background-color: black;" data-color="black"></div>
                        <div class="color-swatch" style="background-color: #e74c3c;" data-color="#e74c3c"></div>
                        <div class="color-swatch" style="background-color: #3498db;" data-color="#3498db"></div>
                        <div class="color-swatch" style="background-color: #2ecc71;" data-color="#2ecc71"></div>
                        <div class="color-swatch" style="background-color: #f1c40f;" data-color="#f1c40f"></div>
                    </div>
                    <div class="mt-4">
                        <label for="line-width-slider" class="flex items-center gap-2 text-sm mb-2 text-white"><i class="fas fa-pen-nib"></i><span>Grosor</span></label>
                        <input type="range" id="line-width-slider" min="1" max="50" value="5" class="line-width-slider w-full">
                    </div>
                </div>
             </div>
             <div class="menu-section">
                <div class="menu-section-header">
                    <span>Utilidades</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="menu-section-content">
                    <div class="tool-grid">
                        <div class="tool-button" id="tool-calc" title="Calculadora"><i class="fas fa-calculator"></i><span>Calc</span></div>
                        <div class="tool-button" id="tool-print" title="Imprimir"><i class="fas fa-print"></i><span>Imprimir</span></div>
                        <div class="tool-button" id="tool-share" title="Compartir"><i class="fas fa-share-alt"></i><span>Compartir</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="mixer-panel" class="hidden absolute w-full shadow-lg border-t translucent-panel">
        <div class="container mx-auto px-6 py-4">
            <h3 class="font-semibold text-lg mb-4 text-white">Mezclador de Ambiente</h3>
            <div id="sound-controls" class="space-y-4"></div>
        </div>
    </div>
    <div id="video-skin-panel" class="hidden absolute w-full shadow-lg border-t translucent-panel">
        <div class="container mx-auto px-6 py-4">
            <h3 class="font-semibold text-lg mb-4 text-white">Selector de Video de Fondo</h3>
            <div id="video-list" class="space-y-2"></div>
        </div>
    </div>
</header>

<main>
    <div class="flipbook-viewport">
        <div class="flipbook-container">
            <div class="flipbook">
                <div class="page hard cover-page" data-drawing-enabled="false"></div>
                <div class="page" data-drawing-enabled="false">
                    <div class="content-wrapper flex flex-col justify-center items-center">
                        <h2 class="text-6xl text-center uppercase" style="font-family: 'Poppins', sans-serif; font-weight: 700;">RUNA COFFEE</h2>
                        <p class="signature mt-8">Creado por Josephine</p>
                    </div>
                    <div class="page-number">1</div>
                </div>
                <div class="page" data-drawing-enabled="false">
                    <div class="content-wrapper">
                        <h2 class="handwriting-title">¡De la tierra, con conciencia!</h2>
                        <p><strong>Representa:</strong> Forma de vivir, sentir, y conectar con consciencia.</p>
                        <p><strong>Runa:</strong> Es una palabra ancestral que en lenguas indígenas andinas significa 'Persona', 'Ser humano en plenitud' o 'Comunidad viva'.</p>
                        <h3>Valores que transmite la marca:</h3>
                        <ul>
                            <li><strong>Autenticidad ancestral:</strong> RUNA honra nuestras raíces, es un tributo a la sabiduría de los pueblos originarios y su forma respetuosa de habitar el mundo.</li>
                            <li><strong>Corazón con la tierra:</strong> Café cultivado con consciencia, en armonía y equilibrio con la naturaleza.</li>
                            <li><strong>Vitalidad Pura:</strong> Energía natural, real, que no solo despierta el cuerpo, sino también el alma.</li>
                            <li><strong>Comunidad:</strong> Cada sorbo une historias, conocimiento, manos campesinas y propósitos.</li>
                        </ul>
                    </div>
                    <div class="page-number">2</div>
                </div>
                <div class="page" data-drawing-enabled="false">
                     <div class="content-wrapper">
                        <h3>Producción consciente:</h3>
                        <p>Cada grano es cultivado en armonía con el entorno, bajo prácticas éticas y sostenibles. Producido por manos locales que trabajan con amor, respeto y dignidad.</p>
                        <h3>Energía viva:</h3>
                        <p>Vitalidad real, sin artificios. Nuestro café especial consciente potencia la plenitud, la conexión con tu interior, equilibrio, autenticidad, salud, vida... propósito.</p>
                        <h3>Diseño con alma:</h3>
                        <p>Como diseñadora, cree un lenguaje visual que une lo que somos... Místicos, naturales, vivos. Cada empaque, símbolo y detalle tiene una intención.</p>
                         <h3>¿A quién va dirigido?</h3>
                        <p>A personas conscientes, exploradores, espirituales, creativos, que no solo buscan sabor sino sentido. A quienes valoran el origen, la historia, y el impacto de lo que consumen.</p>
                        <p class="signature mt-4">"Más que café, un llamado a despertar."</p>
                    </div>
                    <div class="page-number">3</div>
                </div>
                <div class="page" data-drawing-enabled="true"><div class="page-number">4</div></div>
                <div class="page" data-drawing-enabled="true"><div class="page-number">5</div></div>
                <div class="page" data-drawing-enabled="true"><div class="page-number">6</div></div>
                <div class="page" data-drawing-enabled="true"><div class="page-number">7</div></div>
                <div class="page" data-drawing-enabled="true"><div class="page-number">8</div></div>
                <div class="page hard" data-drawing-enabled="false"></div>
            </div>
        </div>
    </div>
</main>

<div id="cart-modal" class="fixed inset-0 z-50 flex items-end sm:items-center sm:justify-end p-0 sm:p-4 bg-black/60 hidden">
    <!-- Content injected by JS -->
</div>

<div class="calculator" id="calculator">
    <div class="calc-header"><i class="fas fa-arrows-alt"></i><i class="fas fa-times close-btn" id="calc-close"></i></div>
    <input type="text" class="calc-display" id="calc-display" readonly>
    <div class="calc-keys">
        <button class="calc-btn">C</button><button class="calc-btn">(</button><button class="calc-btn">)</button><button class="calc-btn operator">/</button>
        <button class="calc-btn">7</button><button class="calc-btn">8</button><button class="calc-btn">9</button><button class="calc-btn operator">*</button>
        <button class="calc-btn">4</button><button class="calc-btn">5</button><button class="calc-btn">6</button><button class="calc-btn operator">-</button>
        <button class="calc-btn">1</button><button class="calc-btn">2</button><button class="calc-btn">3</button><button class="calc-btn operator">+</button>
        <button class="calc-btn">0</button><button class="calc-btn">.</button><button class="calc-btn" id="calc-backspace"><i class="fas fa-backspace"></i></button><button class="calc-btn operator" id="calc-equals">=</button>
    </div>
</div>

<audio id="music-audio" loop><source src="https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/main/public/assets/mp3/runa-main-audio.mp3" type="audio/mpeg"></audio>
<audio id="river-audio" loop><source src="https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/9b1ab5105236fed3644570e1a2ea37f1f1956091/public/assets/mp3/Sonido_de_rio.mp3" type="audio/mpeg"></audio>
<audio id="birds-audio" loop><source src="https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/9b1ab5105236fed3644570e1a2ea37f1f1956091/public/assets/mp3/Sonidos_de_Pajaros.mp3" type="audio/mpeg"></audio>
<audio id="rain-audio" loop><source src="https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/9b1ab5105236fed3644570e1a2ea37f1f1956091/public/assets/mp3/Lluvia.mp3" type="audio/mpeg"></audio>
<audio id="fire-audio" loop><source src="https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/9b1ab5105236fed3644570e1a2ea37f1f1956091/public/assets/mp3/Sonido%20del%20Fuego_de_la_chimenea.mp3" type="audio/mpeg"></audio>
<audio id="wind-audio" loop><source src="https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/9b1ab5105236fed3644570e1a2ea37f1f1956091/public/assets/mp3/sonido_de_viento.mp3" type="audio/mpeg"></audio>
<audio id="storm-audio" loop><source src="https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/9b1ab5105236fed3644570e1a2ea37f1f1956091/public/assets/mp3/Truenos_y_tormentas.mp3" type="audio/mpeg"></audio>

<script type="text/javascript">
$(document).ready(function () {
    const flipbook = $('.flipbook');
    const drawingStates = {};
    let currentTool = 'none';
    let currentColor = 'black';
    let currentLineWidth = 5;
    let isDrawing = false;
    let lastX = 0, lastY = 0;
    const pageFlipSound = new Audio('https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/c2acd6b2dd569ae8ee33f2441eaacb2386e7490d/public/assets/mp3/pasar-hoja-de-libro.mp3');

    flipbook.turn({
        width: $('.flipbook-container').width(),
        height: $('.flipbook-container').height(),
        display: 'single',
        elevation: 50,
        gradients: true,
        autoCenter: true,
        when: {
            turned: (event, page) => {
                loadDrawingForPage(page);
                if (page > 1) {
                    pageFlipSound.currentTime = 2.2;
                    pageFlipSound.play().catch(console.error);
                    setTimeout(() => pageFlipSound.pause(), 1000);
                }
            }
        }
    });

    function getCanvasForPage(pageNumber) {
        let canvas = $(`#canvas-page-${pageNumber}`);
        if (canvas.length === 0) {
            const pageElement = flipbook.find(`.page[page=${pageNumber}]`);
            if (!pageElement.length || pageElement.data('drawing-enabled') !== true) return null;
            
            canvas = $('<canvas>').addClass('drawing-canvas').attr('id', `canvas-page-${pageNumber}`);
            pageElement.append(canvas);
            const canvasEl = canvas[0];
            canvasEl.width = pageElement.width();
            canvasEl.height = pageElement.height();
            saveDrawingForPage(pageNumber);

            canvas.on('mousedown touchstart', startDrawing);
            canvas.on('mousemove touchmove', draw);
            $(window).on('mouseup touchend', stopDrawing);
        }
        return canvas[0];
    }

    function startDrawing(e) {
        if (currentTool === 'none') return;
        isDrawing = true;
        [lastX, lastY] = getCoords(e, $(e.target));
    }

    function draw(e) {
        if (!isDrawing) return;
        e.preventDefault();
        const page = flipbook.turn('page');
        const canvas = getCanvasForPage(page);
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const [x, y] = getCoords(e, $(canvas));
        
        if (currentTool === 'eraser') {
            ctx.globalCompositeOperation = 'destination-out';
            ctx.lineWidth = 25;
        } else {
            ctx.globalCompositeOperation = 'source-over';
            ctx.strokeStyle = currentColor;
            ctx.lineWidth = currentLineWidth;
        }

        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(x, y);
        ctx.lineCap = 'round';
        ctx.stroke();
        [lastX, lastY] = [x, y];
    }

    function stopDrawing() {
        if(isDrawing) {
            const page = flipbook.turn('page');
            const canvas = getCanvasForPage(page);
            if (canvas) {
                canvas.getContext('2d').globalCompositeOperation = 'source-over';
                saveDrawingForPage(page);
            }
        }
        isDrawing = false;
    }

    function getCoords(e, target) {
        const rect = target[0].getBoundingClientRect();
        const touch = e.originalEvent.touches ? e.originalEvent.touches[0] : e;
        return [touch.clientX - rect.left, touch.clientY - rect.top];
    }

    function saveDrawingForPage(pageNumber) {
        const canvas = getCanvasForPage(pageNumber);
        if (canvas) drawingStates[pageNumber] = canvas.toDataURL();
    }

    function loadDrawingForPage(pageNumber) {
        const canvas = getCanvasForPage(pageNumber);
        if (canvas) {
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (drawingStates[pageNumber]) {
                const img = new Image();
                img.onload = () => ctx.drawImage(img, 0, 0);
                img.src = drawingStates[pageNumber];
            }
        }
    }
    setTimeout(() => loadDrawingForPage(1), 100);

    function setActiveTool(tool) {
        $('.tool-button').removeClass('active');
        if (tool !== 'none') $(`#tool-${tool}`).addClass('active');
        currentTool = tool;
    }

    $('#tool-pencil').on('click', () => setActiveTool('pencil'));
    $('#tool-eraser').on('click', () => setActiveTool('eraser'));
    $('.color-swatch').on('click', function() {
        currentColor = $(this).data('color');
        $('.color-swatch').removeClass('active');
        $(this).addClass('active');
        setActiveTool('pencil');
    });
    
    $('#line-width-slider').on('input', function() {
        currentLineWidth = $(this).val();
        setActiveTool('pencil');
    });

    $('#tool-clear').on('click', () => {
        const page = flipbook.turn('page');
        const canvas = getCanvasForPage(page);
        if (canvas) {
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            saveDrawingForPage(page);
        }
    });
    
    $('#tool-print').on('click', () => window.print());
    $('#tool-share').on('click', () => {
        if (navigator.share) {
            navigator.share({
                title: 'RUNA Coffee - Cuaderno Digital',
                text: 'Echa un vistazo a este increíble cuaderno digital de RUNA Coffee!',
                url: window.location.href,
            }).catch(console.error);
        }
    });
    
    $('#tool-upload').on('click', () => $('#image-uploader').click());
    $('#image-uploader').on('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
            const img = new Image();
            img.onload = () => {
                const page = flipbook.turn('page');
                const canvas = getCanvasForPage(page);
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    const maxW = canvas.width * 0.8;
                    const maxH = canvas.height * 0.8;
                    let w = img.width, h = img.height;
                    const ratio = w / h;
                    if (w > maxW) { w = maxW; h = w / ratio; }
                    if (h > maxH) { h = maxH; w = h * ratio; }
                    ctx.drawImage(img, (canvas.width - w) / 2, (canvas.height - h) / 2, w, h);
                    saveDrawingForPage(page);
                }
            };
            img.src = event.target.result;
        };
        reader.readAsDataURL(file);
        $(this).val('');
    });

    const calculator = $('#calculator');
    $('#tool-calc').on('click', () => calculator.fadeToggle());
    $('#calc-close').on('click', () => calculator.fadeOut());
    $('.calc-keys').on('click', '.calc-btn', function() {
        const key = $(this).text();
        const displayVal = $('#calc-display').val();
        if (key === 'C') {
            $('#calc-display').val('');
        } else if ($(this).is('#calc-backspace')) {
            $('#calc-display').val(displayVal.slice(0, -1));
        } else if ($(this).is('#calc-equals')) {
            try {
                $('#calc-display').val(eval(displayVal.replace('×', '*').replace('÷', '/')));
            } catch {
                $('#calc-display').val('Error');
            }
        } else {
            $('#calc-display').val(displayVal + key);
        }
    });

    // --- HEADER SCRIPT LOGIC ---
    const themeToggle = $('#theme-toggle');
    const sunIcon = $('#theme-icon-sun');
    const moonIcon = $('#theme-icon-moon');
    const mainMenu = $('#main-menu');
    const mixerPanel = $('#mixer-panel');
    const videoSkinPanel = $('#video-skin-panel');

    function applyTheme(theme) {
        if (theme === 'dark') {
            $('html').removeClass('light').addClass('dark');
            sunIcon.show();
            moonIcon.hide();
        } else {
            $('html').removeClass('dark').addClass('light');
            sunIcon.hide();
            moonIcon.show();
        }
    }

    themeToggle.on('click', () => {
        const newTheme = $('html').hasClass('dark') ? 'light' : 'dark';
        localStorage.setItem('runaTheme', newTheme);
        applyTheme(newTheme);
    });

    const savedTheme = localStorage.getItem('runaTheme') || 'light';
    applyTheme(savedTheme);

    function closeAllPanels() {
        mainMenu.addClass('hidden');
        mixerPanel.addClass('hidden');
        videoSkinPanel.addClass('hidden');
    }

    $('#menu-button').on('click', (e) => {
        e.stopPropagation();
        const wasOpen = !mainMenu.hasClass('hidden');
        closeAllPanels();
        if (!wasOpen) mainMenu.removeClass('hidden');
    });

    $('#mixer-toggle-button').on('click', (e) => {
        e.stopPropagation();
        const wasOpen = !mixerPanel.hasClass('hidden');
        closeAllPanels();
        if (!wasOpen) mixerPanel.removeClass('hidden');
    });

    $('#video-skin-toggle').on('click', (e) => {
        e.stopPropagation();
        const wasOpen = !videoSkinPanel.hasClass('hidden');
        closeAllPanels();
        if (!wasOpen) videoSkinPanel.removeClass('hidden');
    });
    
    $(window).on('click', (e) => {
        if (!$(e.target).closest('#main-header').length) {
            closeAllPanels();
        }
    });

    $('.menu-section-header').on('click', function() {
        $(this).toggleClass('active').next('.menu-section-content').slideToggle();
    });

    // --- Mixer and Video Selector Logic ---
    const videoSkins = [
        { name: "Cascada Relajante", url: "https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/71882ac786adf1438958f62935ab5b2d35a82ae5/public/assets/videos/cascada-relajante.mp4" },
        { name: "Cosecha de Café", url: "https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/a3de99a321f33e21822225fda04f372c7033aad0/public/assets/videos/runa_video_fondo_1.mp4" },
        { name: "Naturaleza y Café", url: "https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/abb2e1a716439dd1ba47f48c0bba176ff72e197e/public/assets/videos/runa-fondo-video.mp4" }
    ];
    let currentVideoIndex = 0;

    const ambienceSounds = [
        { id: 'music-audio', name: 'Música', gifSrc: 'https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/741d48f54473497390f1b028f4e2a2b874459088/public/assets/gif/music.gif' },
        { id: 'river-audio', name: 'Río', gifSrc: 'https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/741d48f54473497390f1b028f4e2a2b874459088/public/assets/gif/river.gif' },
        { id: 'birds-audio', name: 'Pájaros', gifSrc: 'https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/741d48f54473497390f1b028f4e2a2b874459088/public/assets/gif/birds.gif' },
        { id: 'rain-audio', name: 'Lluvia', gifSrc: 'https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/1502311c7a2daf5ee882bb36da3e6555680fd5e8/public/assets/gif/rain.gif' },
        { id: 'fire-audio', name: 'Fuego', gifSrc: 'https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/1502311c7a2daf5ee882bb36da3e6555680fd5e8/public/assets/gif/fire.gif' },
        { id: 'wind-audio', name: 'Viento', gifSrc: 'https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/1502311c7a2daf5ee882bb36da3e6555680fd5e8/public/assets/gif/wind.gif' },
        { id: 'storm-audio', name: 'Tormenta', gifSrc: 'https://raw.githubusercontent.com/Yanzsmartwood2025/Runacoffee/1502311c7a2daf5ee882bb36da3e6555680fd5e8/public/assets/gif/storm.gif' },
    ];
    
    function initializeMixer() {
        const soundControlsContainer = $('#sound-controls');
        if(!soundControlsContainer.length) return;
        soundControlsContainer.html('');
        
        ambienceSounds.forEach(sound => {
            const audioEl = document.getElementById(sound.id);
            if (!audioEl) return;

            const controlHTML = `
                <div class="flex items-center gap-4 text-sm text-white">
                    <button id="btn-${sound.id}" class="mixer-icon-button relative w-10 h-10 rounded-full shadow-md flex-shrink-0 overflow-hidden"><img src="${sound.gifSrc}" alt="${sound.name}"></button>
                    <span class="font-medium w-20 truncate">${sound.name}</span>
                    <input type="range" id="volume-${sound.id}" min="0" max="1" step="0.01" value="0" class="flex-grow volume-slider">
                </div>
            `;
            soundControlsContainer.append(controlHTML);

            const slider = $(`#volume-${sound.id}`);
            const button = $(`#btn-${sound.id}`);
            
            const updateSliderStyle = (target) => {
                const percent = (target.val() / target.attr('max')) * 100;
                target.css('--value-percent', `${percent}%`);
            };

            slider.on('input', function() {
                const newVolume = parseFloat($(this).val());
                audioEl.volume = newVolume;
                button.toggleClass('active', newVolume > 0);
                updateSliderStyle($(this));
                if (newVolume > 0 && audioEl.paused) {
                    audioEl.play().catch(console.error);
                } else if (newVolume === 0 && !audioEl.paused) {
                    audioEl.pause();
                }
            });
            
            button.on('click', function() {
                if (slider.val() > 0) {
                    slider.data('lastValue', slider.val());
                    slider.val(0);
                } else {
                    slider.val(slider.data('lastValue') || 0.5);
                }
                slider.trigger('input');
            });
            updateSliderStyle(slider);
        });
    }

    function setVideoSkin(index) {
        const video = $('#video-background');
        const source = $('#video-source');
        if(video.length && source.length){
            video.css('opacity', 0);
            setTimeout(() => {
                currentVideoIndex = index;
                source.attr('src', videoSkins[currentVideoIndex].url);
                video[0].load();
                video[0].play().catch(console.error);
                video.css('opacity', 1);
                localStorage.setItem('runaVideoSkin', currentVideoIndex);
                updateVideoListUI();
            }, 500);
        }
    }

    function updateVideoListUI() {
        const videoListContainer = $('#video-list');
        if (!videoListContainer.length) return;
        videoListContainer.find('button').each(function(index) {
            $(this).toggleClass('active', index === currentVideoIndex);
        });
    }
    
    function initializeVideoSelector() {
        const videoListContainer = $('#video-list');
        if(!videoListContainer.length) return;
        videoListContainer.html('');

        videoSkins.forEach((skin, index) => {
            const button = $(`<button class="video-list-button w-full text-left p-2 rounded-lg transition-colors duration-200 text-white">${skin.name}</button>`);
            button.on('click', () => setVideoSkin(index));
            videoListContainer.append(button);
        });
        updateVideoListUI();
    }

    initializeMixer();
    initializeVideoSelector();
    const savedSkinIndex = parseInt(localStorage.getItem('runaVideoSkin')) || 0;
    setVideoSkin(savedSkinIndex);

    // --- Cart Logic ---
    let cart = [];
    const cartModal = $('#cart-modal');
    const cartCounter = $('#cart-counter');

    function updateCartCounter() {
        if (cart.length > 0) {
            cartCounter.text(cart.length).removeClass('hidden');
        } else {
            cartCounter.addClass('hidden');
        }
    }

    function renderCartModal() {
        let contentHTML = '';
        if (cart.length === 0) {
            contentHTML = `<div class="p-8 flex-grow flex flex-col items-center justify-center text-center"><svg class="w-16 h-16 text-gray-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg><h3 class="font-semibold text-lg text-white">Tu carrito está vacío</h3><p class="text-sm text-gray-400">Añade productos para verlos aquí.</p></div>`;
        } else {
            // Logic to display items would go here
        }

        cartModal.html(`<div class="translucent-panel w-full max-w-sm h-full sm:h-auto sm:rounded-2xl shadow-2xl flex flex-col ml-auto"><header class="p-4 border-b border-white/10 flex justify-between items-center"><h2 class="text-xl font-bold text-white">Tu Carrito</h2><button id="close-cart-button" class="p-1 rounded-full text-white hover:bg-white/10 transition-colors"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></header>${contentHTML}</div>`);
        $('#close-cart-button').on('click', closeCart);
    }

    function openCart() {
        renderCartModal();
        cartModal.removeClass('hidden');
    }

    function closeCart() {
        cartModal.addClass('hidden');
    }

    $('#open-cart-button').on('click', openCart);
    cartModal.on('click', (event) => {
        if (event.target === cartModal[0]) {
            closeCart();
        }
    });

    $(window).on('resize', () => {
        flipbook.turn('size', $('.flipbook-container').width(), $('.flipbook-container').height());
    }).trigger('resize');
});
</script>

</body>
</html>
